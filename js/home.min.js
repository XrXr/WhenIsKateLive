// Author: XrXr
// https://github.com/XrXr/WhenIsKateLive
// License: MIT
(function(){function s(a,b){var l=a.get_sorted_array(),c;l.some(function(a,e){if(b.isAfter(a.end))return!1;c=a;return!0});return c?c:l[0]}function n(){var a=moment(),b=moment(0);p(b);b.year(1970);b.isoWeek(1);b.isoWeekday(a.isoWeekday());b.hours(a.hours());b.minutes(a.minutes());b.seconds(a.seconds());a=b.unix();if(q.is_live(a))return m=!0,r(!0);if(m)return m=!1,q=s(k,b),n();m=!1;return r(!1,t(a,q))}var p=function(){var a=(new Date).getTimezoneOffset();return function(b){b.zone(a);return b}}(),k=
function(){function a(d,b,e){if(!(this instanceof a))return new a(d,b,e);this.key=d.toLowerCase();this.start=b;d=d.toLowerCase();d=c.indexOf(d);if(-1===d)throw Error("Invalid weekday name");this.isoWeekday=d+1;this.duration=e}function b(d,a){if(!(this instanceof b))return new b(d,a);this.start=d.clone();this.end=d.clone();this.end.add("hours",a);this.duration=a}function l(d,a){return d.start.unix()-a.start.unix()}var c="monday tuesday wednesday thursday friday saturday sunday".split(" "),f=[a("Monday",
20,3),a("Tuesday",13,2),a("Thursday",22,2),a("Saturday",20,3)];b.prototype.convert_time=function(){p(this.start);p(this.end)};b.prototype.normalize=function(){this.start.year(1970);this.start.isoWeek(1);this.end.year(1970);this.end.isoWeek(1)};b.prototype.toString=function(){var d=this.start.format("a");return d===this.end.format("a")?this.start.format("h")+" to "+this.end.format("h")+" "+d:this.start.format("h a")+" to "+this.end.format("h a")};b.prototype.is_live=function(d){return d>=this.start.unix()&&
d<=this.end.unix()};var e={},g=moment(0);g.zone(480);var h=null;Object.defineProperty(e,"length",{value:f.length});f.forEach(function(d,a){h=g.clone();h.isoWeekday(d.isoWeekday);h.hours(d.start);e[a]=new b(h,d.duration);e[a].convert_time()});Object.defineProperty(e,"get_sorted_array",{value:function(){var d=null;return function(){if(null!==d)return d;var a=[],b;for(b in this)this.hasOwnProperty(b)&&a.push(this[b]);d=a.sort(l);return a}}()});return e}(),t=function(){function a(a,b){var f=a+" "+b;return 1<
a?f+"s":f}function b(b){var c=moment.duration(1E3*b);b=c.days();var f=c.hours(),e=c.minutes(),c=c.seconds(),g=[];b&&g.push(a(b,"day"));f&&g.push(a(f,"hour"));e&&g.push(a(e,"minute"));c&&g.push(a(c,"second"));return g.join(", ")}return function(a,c){var f=c.start.unix()-a;if(0<f)return b(f);if(0>f)return b(c.start.clone().add("weeks",1).unix()-a);throw Error("get_countdown() called with Invalid arguments");}}(),r=function(){function a(a){return new RegExp("(?:^|\\s)"+a+"(?!\\S)","g")}function b(b,
c){b.className.match(0===a(c).length)&&(b.className+=" "+c)}function l(b,c){b.className.match(0<a(c).length)&&(b.className=b.className.replace(a(c),""))}for(var c=document.querySelectorAll("tr"),f=c[0];f.children.length<k.length;)f.appendChild(document.createElement("th"));for(var e=0;e<k.length;e++)f.children[e].textContent=k[e].start.format("dddd");for(c=c[1];c.children.length<k.length;)c.appendChild(document.createElement("td"));for(e=0;e<k.length;e++)c.children[e].textContent=k[e].toString();
document.querySelector("small").textContent="All times are converted to your local time";var g=document.querySelector("h3"),h=document.querySelector("h1").children[0];return function(a,c){a?(b(g,"soft-hide"),l(h,"disguise prefix"),h.textContent="Kate is live right now! Click to watch",h.href="http://www.twitch.tv/lovelymomo"):(l(g,"soft-hide"),b(h,"disguise prefix"),h.textContent=c,h.href="#")}}(),q=k[0],m=!0;n();setInterval(n,1E3)})();
